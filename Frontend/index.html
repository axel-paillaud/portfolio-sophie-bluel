<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<title>Sophie Bluel - Architecte d'intérieur</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Work+Sans&display=swap" rel="stylesheet">
	<meta name="description" content="">
	<link rel="stylesheet" href="./assets/style.css">
	<script src="https://kit.fontawesome.com/cc75d89bda.js" crossorigin="anonymous"></script>
</head>
<body>
	<div id="header-edition-mode"></div>
	<header>
		<h1>Sophie Bluel <span>Architecte d'intérieur</span></h1>
		<nav>
			<ul>
				<li><a href="index.html">projets</a></li>
				<li><a href="#contact">contact</a></li>
				<li><a href="login.html">login</a></li>
				<li><img src="./assets/icons/instagram.png" alt="Instagram"></li>
			</ul>
		</nav>
	</header>
	<main>
		<div id="edit-modal" class="modal" data-show="false" style="display: none;">
			<article class="modal-wrapper js-modal-stop">
			</article>
		</div>
		<section id="introduction">
			<figure>
				<img src="./assets/images/sophie-bluel.png" alt="Sophie Bluel">
				<figcaption class="js-edit base-link"></figcaption>
			</figure>
			<article>
				<a class="js-edit base-link"></a>
				<h2>Designer d'espace</h2>
				<p>Je raconte votre histoire, je valorise vos idées. Je vous accompagne de la conception à la livraison finale du chantier.</p>
				<p>
					Chaque projet sera étudié en commun, de façon à mettre en valeur les volumes,
					les matières et les couleurs dans le respect de l’esprit des lieux et le choix adapté des matériaux. 
					Le suivi du chantier sera assuré dans le souci du détail, le respect du planning et du budget.
				</p>
				<p>En cas de besoin, une équipe pluridisciplinaire peut-être constituée : architecte DPLG, décorateur(trice)</p>
			</article>
		</section>
		<section id="portfolio">
			<section class="my-project">
				<h2>Mes Projets</h2>
				<a class="js-edit js-modal base-link" href="#edit-modal"></a>
			</section>
			<div class="filters">
			</div>
			<div class="gallery">
			</div>
		</section>
		<section id="contact">
			<h2>Contact</h2>
			<p>Vous avez un projet ? Discutons-en !</p>
			<form action="#" method="post">
				<label for="name">Nom</label>
				<input type="text" name="name" id="name">
				<label for="email">Email</label>
				<input type="email" name="email" id="email">
				<label for="message">Message</label>
				<textarea name="message" id="message" cols="30" rows="10"></textarea>
				<input type="submit" value="Envoyer">
			</form>
		</section>
	</main>
	<footer>
		<nav>
			<ul>
				<li>Mentions Légales</li>
			</ul>
		</nav>
	</footer>
	<script crossorigin>
		const worksURI = "/api/works";
const categoriesURI = "/api/categories";

//Global variable here to select this class only once, and not multiple time
//inside the forEach loop of addAllWorks
var gallery = document.getElementsByClassName("gallery")[0];
var works;

//delete all works in the DOM
function resetDOM(element) {
    element.replaceChildren();
}

//get all works from server
async function getWorks() {
    await fetch(worksURI)
    .then(function(res) {
        if (res.ok) {
            return res.json();
        }
    })
    .then(function(value) {
        works = value;
        return works;
        })
    .catch(function(err) {
        console.log("Une erreur sur la récupération des travaux est survenue");
        console.log(err);
    });
}

//add all works to the DOM
function addAllWorks(works, element) {
    works.forEach(work => {
        addWork(work, element, work.title);
    });
}

//add work to the DOM
function addWork(works, element, title) {

    let figure = document.createElement("figure");
    let img = document.createElement("img");
    let figcaption = document.createElement("figcaption");

    //Add image, attribute and title to the DOM
    element.appendChild(figure).appendChild(img)
    .setAttribute('src', works.imageUrl);

    img.setAttribute('alt', works.title);
    img.setAttribute('crossorigin', 'anonymous');
    figure.appendChild(figcaption)
    .innerHTML = title;
    return figure;
}

//get all categories from server
async function getCategories() {
    const categories = [];
     await fetch(categoriesURI)
    .then(function(res) {
        if (res.ok) {
            return res.json();
        }
    })
    .then(function(value) {
        value.forEach(category => {
            categories.push(category);
        });
    })
    .catch(function(err) {
        console.log(err);
    });
    return categories;
}

//add categories to the DOM
function addCategories(categories) {
    let button = document.createElement("button");
    let categoryElt = document.getElementsByClassName("filters")[0];
    document.getElementsByClassName("filters")[0]
    .appendChild(button)
    .setAttribute('data-id', 0);
    button.innerHTML = "Tous";

    for (let i = 0; i < categories.length; i++) {
        let button = document.createElement("button");
        categoryElt.appendChild(button).setAttribute('data-id', categories[i].id);
        button.innerHTML = categories[i].name;
    }
}

//Add event listeners on click for all categories, and filters on click
function addEventToCategories(works, element) {
    document.querySelectorAll(".filters button")
    .forEach(filter => {
        filter.addEventListener('click', function(value) {
            let categoryId = value.target.dataset.id;
            categoryId = parseInt(categoryId);

            //filters categories on click
            filtersCategories(works, categoryId, element);
        })
    });
}

//filters categories
function filtersCategories(works, categoryId, element) {
    resetDOM(gallery);

    if (categoryId == 0) {
        addAllWorks(works, element);
    }
    else {
        works.forEach(work => {
        if (work["categoryId"] == categoryId) {
            addWork(work, element, work.title);
        }
        });
    }
}

//execution of functions goes here

const promiseWorks = getWorks()
.then(function() {
    addAllWorks(works, gallery);
    return works;
})
.then(function(works) {
    getCategories()
    .then(function(categories) {
        addCategories(categories);
        addEventToCategories(works, gallery);
    });
    return works;
})
.catch(function(err) {
    console.log(err);
});

	</script>
{# <script src="./assets/js/script.js"></script> #}
<script src="./assets/js/admin.js"></script>
<script src="./assets/js/modal.js"></script>
</body>
</html>
